
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../TelLiveRebootStressTest/">
      
      
        <link rel="next" href="../TelLiveRilDataKpiTest/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.25">
    
    
      
        <title>TelLiveRilCstVoiceTest - ACTS Live Telephony Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tests.google.tel.live.TelLiveRilCstVoiceTest" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="ACTS Live Telephony Docs" class="md-header__button md-logo" aria-label="ACTS Live Telephony Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ACTS Live Telephony Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              TelLiveRilCstVoiceTest
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ACTS Live Telephony Docs" class="md-nav__button md-logo" aria-label="ACTS Live Telephony Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    ACTS Live Telephony Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveCBRSTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveCBRSTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveCellInfoTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveCellInfoTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveConnectivityMonitorBaseTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveConnectivityMonitorBaseTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveConnectivityMonitorTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveConnectivityMonitorTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveDataTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveDataTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveDSDSVoiceTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveDSDSVoiceTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveEmergencyTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveEmergencyTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveGFTDSDSDDSSwitchTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveGFTDSDSDDSSwitchTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveGFTDSDSMessageTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveGFTDSDSMessageTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveGFTDSDSSupplementaryServiceTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveGFTDSDSSupplementaryServiceTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveGFTDSDSVoiceTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveGFTDSDSVoiceTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveGFTDSDSWfcSupplementaryServiceTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveGFTDSDSWfcSupplementaryServiceTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveGFTRcsTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveGFTRcsTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveImsSettingsTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveImsSettingsTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveLockedSimTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveLockedSimTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveMobilityStressTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveMobilityStressTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveNoQXDMLogTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveNoQXDMLogTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveNoSimTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveNoSimTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLivePostflightTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLivePostflightTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLivePreflightTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLivePreflightTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveProjectFiTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveProjectFiTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveRcsTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveRcsTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveRebootStressTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveRebootStressTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    TelLiveRilCstVoiceTest
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    TelLiveRilCstVoiceTest
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tests.google.tel.live.TelLiveRilCstVoiceTest" class="md-nav__link">
    <span class="md-ellipsis">
      TelLiveRilCstVoiceTest
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tests.google.tel.live.TelLiveRilCstVoiceTest.TelLiveRilCstVoiceTest" class="md-nav__link">
    <span class="md-ellipsis">
      TelLiveRilCstVoiceTest
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TelLiveRilCstVoiceTest">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tests.google.tel.live.TelLiveRilCstVoiceTest.TelLiveRilCstVoiceTest.enable_cst" class="md-nav__link">
    <span class="md-ellipsis">
      enable_cst
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tests.google.tel.live.TelLiveRilCstVoiceTest.TelLiveRilCstVoiceTest.force_roaming" class="md-nav__link">
    <span class="md-ellipsis">
      force_roaming
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tests.google.tel.live.TelLiveRilCstVoiceTest.TelLiveRilCstVoiceTest.get_force_roaming_state" class="md-nav__link">
    <span class="md-ellipsis">
      get_force_roaming_state
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tests.google.tel.live.TelLiveRilCstVoiceTest.TelLiveRilCstVoiceTest.msim_cst_call_voice" class="md-nav__link">
    <span class="md-ellipsis">
      msim_cst_call_voice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tests.google.tel.live.TelLiveRilCstVoiceTest.TelLiveRilCstVoiceTest.msim_cst_registration" class="md-nav__link">
    <span class="md-ellipsis">
      msim_cst_registration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveRilDataKpiTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveRilDataKpiTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveRilImsKpiTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveRilImsKpiTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveRilImsKpiTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveRilImsKpiTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveRilMessageKpiTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveRilMessageKpiTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveSettingsTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveSettingsTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveSmokeTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveSmokeTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveSmsTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveSmsTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveStressCallTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveStressCallTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveStressDataTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveStressDataTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveStressFdrTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveStressFdrTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveStressSmsTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveStressSmsTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveStressTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveStressTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveVideoDataTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveVideoDataTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveVideoTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveVideoTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveVoiceConfTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveVoiceConfTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelLiveVoiceTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelLiveVoiceTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelWifiDataTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelWifiDataTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelWifiVideoTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelWifiVideoTest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TelWifiVoiceTest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TelWifiVoiceTest
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tests.google.tel.live.TelLiveRilCstVoiceTest" class="md-nav__link">
    <span class="md-ellipsis">
      TelLiveRilCstVoiceTest
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tests.google.tel.live.TelLiveRilCstVoiceTest.TelLiveRilCstVoiceTest" class="md-nav__link">
    <span class="md-ellipsis">
      TelLiveRilCstVoiceTest
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TelLiveRilCstVoiceTest">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tests.google.tel.live.TelLiveRilCstVoiceTest.TelLiveRilCstVoiceTest.enable_cst" class="md-nav__link">
    <span class="md-ellipsis">
      enable_cst
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tests.google.tel.live.TelLiveRilCstVoiceTest.TelLiveRilCstVoiceTest.force_roaming" class="md-nav__link">
    <span class="md-ellipsis">
      force_roaming
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tests.google.tel.live.TelLiveRilCstVoiceTest.TelLiveRilCstVoiceTest.get_force_roaming_state" class="md-nav__link">
    <span class="md-ellipsis">
      get_force_roaming_state
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tests.google.tel.live.TelLiveRilCstVoiceTest.TelLiveRilCstVoiceTest.msim_cst_call_voice" class="md-nav__link">
    <span class="md-ellipsis">
      msim_cst_call_voice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tests.google.tel.live.TelLiveRilCstVoiceTest.TelLiveRilCstVoiceTest.msim_cst_registration" class="md-nav__link">
    <span class="md-ellipsis">
      msim_cst_registration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>TelLiveRilCstVoiceTest</h1>

<div class="doc doc-object doc-module">



<a id="tests.google.tel.live.TelLiveRilCstVoiceTest"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tests.google.tel.live.TelLiveRilCstVoiceTest.TelLiveRilCstVoiceTest" class="doc doc-heading">
            <code>TelLiveRilCstVoiceTest</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="acts_contrib.test_utils.tel.TelephonyBaseTest.TelephonyBaseTest">TelephonyBaseTest</span></code></p>


              <details class="quote">
                <summary>Source code in <code>tests/google/tel/live/TelLiveRilCstVoiceTest.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TelLiveRilCstVoiceTest</span><span class="p">(</span><span class="n">TelephonyBaseTest</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setup_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">TelephonyBaseTest</span><span class="o">.</span><span class="n">setup_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">start_pixellogger_always_on_logging</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">android_devices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tel_logger</span> <span class="o">=</span> <span class="n">TelephonyMetricLogger</span><span class="o">.</span><span class="n">for_test_case</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">teardown_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_cst</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">android_devices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">force_roaming</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">android_devices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">ensure_phones_idle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">android_devices</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">enable_cst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ad</span><span class="p">,</span> <span class="n">slot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable/disable Cross SIM Calling by SL4A API at given slot</span>

<span class="sd">            Args:</span>
<span class="sd">                ad: Android object</span>
<span class="sd">                slot: 0 for pSIM and 1 for eSIM</span>
<span class="sd">                enable: True fo enabling and False for disabling</span>

<span class="sd">            Raises:</span>
<span class="sd">                TestFailure if False is returned by</span>
<span class="sd">                imsMmTelIsCrossSimCallingEnabled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">slot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">slots</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">slots</span> <span class="o">=</span> <span class="p">[</span><span class="n">slot</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">slots</span><span class="p">:</span>
            <span class="n">sub_id</span> <span class="o">=</span> <span class="n">get_subid_from_slot_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ad</span><span class="p">,</span> <span class="n">slot</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ad</span><span class="o">.</span><span class="n">droid</span><span class="o">.</span><span class="n">imsMmTelIsCrossSimCallingEnabled</span><span class="p">(</span><span class="n">sub_id</span><span class="p">)</span> <span class="o">==</span> <span class="n">enable</span><span class="p">:</span>
                <span class="n">ad</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s1">&#39;Status of backup calling at slot </span><span class="si">%s</span><span class="s1"> is already </span><span class="si">%s</span><span class="s1">.&#39;</span><span class="p">,</span>
                    <span class="n">slot</span><span class="p">,</span> <span class="n">enable</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ad</span><span class="o">.</span><span class="n">droid</span><span class="o">.</span><span class="n">imsMmTelSetCrossSimCallingEnabled</span><span class="p">(</span><span class="n">sub_id</span><span class="p">,</span> <span class="n">enable</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ad</span><span class="o">.</span><span class="n">droid</span><span class="o">.</span><span class="n">imsMmTelIsCrossSimCallingEnabled</span><span class="p">(</span><span class="n">sub_id</span><span class="p">)</span> <span class="o">==</span> <span class="n">enable</span><span class="p">:</span>
                    <span class="n">ad</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s1">&#39;Backup calling at slot </span><span class="si">%s</span><span class="s1"> is set to </span><span class="si">%s</span><span class="s1"> successfully.&#39;</span><span class="p">,</span>
                        <span class="n">slot</span><span class="p">,</span> <span class="n">enable</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ad</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="s1">&#39;Backup calling at slot </span><span class="si">%s</span><span class="s1"> is NOT set to </span><span class="si">%s</span><span class="s1">.&#39;</span><span class="p">,</span>
                        <span class="n">slot</span><span class="p">,</span> <span class="n">enable</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="n">signals</span><span class="o">.</span><span class="n">TestFailure</span><span class="p">(</span>
                        <span class="s2">&quot;Failed&quot;</span><span class="p">,</span>
                        <span class="n">extras</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fail_reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Failed to set Backup calling.&quot;</span><span class="p">})</span>


    <span class="k">def</span> <span class="nf">get_force_roaming_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ad</span><span class="p">,</span> <span class="n">slot</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the value of the property:</span>
<span class="sd">                getprop persist.vendor.radio.force_roaming</span>

<span class="sd">            Args:</span>
<span class="sd">                ad: Android object</span>
<span class="sd">                slot: 0 for pSIM and 1 for eSIM</span>

<span class="sd">            Returns:</span>
<span class="sd">                0 for not roaming and 1 for roaming</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;adb -s </span><span class="si">%s</span><span class="s1"> shell getprop persist.vendor.radio.force_roaming</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">ad</span><span class="o">.</span><span class="n">serial</span><span class="p">,</span> <span class="n">slot</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span>


    <span class="k">def</span> <span class="nf">force_roaming</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ad</span><span class="p">,</span> <span class="n">slot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">roaming</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Force assigned slot to roam ot not to roam by setting specific property</span>

<span class="sd">            Args:</span>
<span class="sd">                ad: Android object</span>
<span class="sd">                slot: 0 for pSIM and 1 for eSIM</span>
<span class="sd">                roaming: 1 to force to roam. Otherwise 0.</span>

<span class="sd">            Returns:</span>
<span class="sd">                True or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">slot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">slots</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">slots</span> <span class="o">=</span> <span class="p">[</span><span class="n">slot</span><span class="p">]</span>

        <span class="n">need_reboot</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">slots</span><span class="p">:</span>
            <span class="n">roamimg_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_force_roaming_state</span><span class="p">(</span><span class="n">ad</span><span class="p">,</span> <span class="n">slot</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">roamimg_state</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">roamimg_state</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">roaming</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">roaming</span><span class="p">:</span>
                        <span class="n">ad</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Slot </span><span class="si">%s</span><span class="s1"> is already roaming.&#39;</span> <span class="o">%</span> <span class="n">slot</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ad</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Slot </span><span class="si">%s</span><span class="s1"> is already on home network.&#39;</span> <span class="o">%</span> <span class="n">slot</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;adb -s </span><span class="si">%s</span><span class="s1"> shell setprop persist.vendor.radio.force_roaming</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ad</span><span class="o">.</span><span class="n">serial</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">roaming</span><span class="p">)</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                    <span class="n">need_reboot</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">need_reboot</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">reboot_test</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ad</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">slots</span><span class="p">:</span>
                    <span class="n">roamimg_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_force_roaming_state</span><span class="p">(</span><span class="n">ad</span><span class="p">,</span> <span class="n">slot</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">roamimg_state</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">roaming</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">roaming</span><span class="p">:</span>
                            <span class="n">ad</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Slot </span><span class="si">%s</span><span class="s1"> is now roaming.&#39;</span> <span class="o">%</span> <span class="n">slot</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ad</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Slot </span><span class="si">%s</span><span class="s1"> is now on home network.&#39;</span> <span class="o">%</span> <span class="n">slot</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">roaming</span><span class="p">:</span>
                            <span class="n">ad</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                                <span class="s1">&#39;Slot </span><span class="si">%s</span><span class="s1"> is expected to be roaming (roamimg state: </span><span class="si">%s</span><span class="s1">).&#39;</span> <span class="o">%</span> <span class="n">roamimg_state</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ad</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                                <span class="s1">&#39;Slot </span><span class="si">%s</span><span class="s1"> is expected to be on home network (roamimg state: </span><span class="si">%s</span><span class="s1">).&#39;</span> <span class="o">%</span> <span class="n">roamimg_state</span><span class="p">)</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="n">result</span>


    <span class="k">def</span> <span class="nf">msim_cst_registration</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">cst_slot</span><span class="p">,</span>
            <span class="n">rat</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
            <span class="n">wfc_mode</span><span class="o">=</span><span class="n">WFC_MODE_WIFI_PREFERRED</span><span class="p">,</span>
            <span class="n">force_roaming</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">test_cycles</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make MO/MT voice call at specific slot in specific RAT with DDS at</span>
<span class="sd">        specific slot.</span>

<span class="sd">        Test step:</span>
<span class="sd">        1. Get sub IDs of specific slots of both MO and MT devices.</span>
<span class="sd">        2. Switch DDS to specific slot.</span>
<span class="sd">        3. Check HTTP connection after DDS switch.</span>
<span class="sd">        4. Set up phones in desired RAT.</span>

<span class="sd">        Args:</span>
<span class="sd">            cst_slot: Slot at which CST registered</span>
<span class="sd">            rat: RAT for both slots</span>
<span class="sd">            wfc_mode: cullelar-preferred or wifi-preferred</span>
<span class="sd">            force_roaming: True for fake roaming by setprop</span>
<span class="sd">            test_cycles: Amount of the test cycles</span>

<span class="sd">        Returns:</span>
<span class="sd">            True in the end. Otherwise the exception TestFailure will be raised.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TestFailure if:</span>
<span class="sd">                1. Invalid sub ID is returned.</span>
<span class="sd">                2. DDS cannot be switched successfully.</span>
<span class="sd">                3. Http connection cannot be verified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ads</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">android_devices</span>
        <span class="n">set_location_service</span><span class="p">(</span><span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">test_cycles</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">test_cycles</span><span class="p">)</span>
        <span class="n">cst_reg_search_intervals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cst_reg_fail</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">exit_due_to_high_fail_rate</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">test_cycles</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;======&gt; Test cycle </span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1"> &lt;======&#39;</span><span class="p">,</span> <span class="n">attempt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">test_cycles</span><span class="p">)</span>
            <span class="n">cst_reg_begin_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="n">cst_slot_sub_id</span> <span class="o">=</span> <span class="n">get_subid_from_slot_index</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cst_slot</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cst_slot_sub_id</span> <span class="o">==</span> <span class="n">INVALID_SUB_ID</span><span class="p">:</span>
                <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to get sub ID ar slot </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">cst_slot</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">signals</span><span class="o">.</span><span class="n">TestFailure</span><span class="p">(</span>
                    <span class="s1">&#39;Failed&#39;</span><span class="p">,</span>
                    <span class="n">extras</span><span class="o">=</span><span class="p">{</span>
                        <span class="s1">&#39;fail_reason&#39;</span><span class="p">:</span> <span class="s1">&#39;Slot ID </span><span class="si">%s</span><span class="s1"> at slot </span><span class="si">%s</span><span class="s1"> is invalid.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="n">cst_slot_sub_id</span><span class="p">,</span> <span class="n">cst_slot</span><span class="p">)})</span>
            <span class="n">other_sub_id</span> <span class="o">=</span> <span class="n">get_subid_from_slot_index</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="o">-</span><span class="n">cst_slot</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable_cst</span><span class="p">(</span><span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">slot</span><span class="o">=</span><span class="n">cst_slot</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Step 1: Switch DDS.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">set_dds_on_slot</span><span class="p">(</span><span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">cst_slot</span><span class="p">):</span>
                <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to set DDS to slot </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">cst_slot</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">signals</span><span class="o">.</span><span class="n">TestFailure</span><span class="p">(</span>
                    <span class="s1">&#39;Failed&#39;</span><span class="p">,</span>
                    <span class="n">extras</span><span class="o">=</span><span class="p">{</span>
                        <span class="s1">&#39;fail_reason&#39;</span><span class="p">:</span> <span class="s1">&#39;Failed to set DDS to slot </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">cst_slot</span><span class="p">})</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Step 2: Check HTTP connection after DDS switch.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">verify_http_connection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
                <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://www.google.com&quot;</span><span class="p">,</span>
                <span class="n">retry</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                <span class="n">retry_interval</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                <span class="n">expected_state</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to verify http connection.&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">signals</span><span class="o">.</span><span class="n">TestFailure</span><span class="p">(</span>
                    <span class="s1">&#39;Failed&#39;</span><span class="p">,</span>
                    <span class="n">extras</span><span class="o">=</span><span class="p">{</span>
                        <span class="s1">&#39;fail_reason&#39;</span><span class="p">:</span> <span class="s1">&#39;Failed to verify http connection.&#39;</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Verify http connection successfully.&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Step 3: Set up phones in desired RAT.&quot;</span><span class="p">)</span>
            <span class="n">phone_setup_on_rat</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
                <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">rat</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="n">cst_slot</span><span class="p">],</span>
                <span class="n">other_sub_id</span><span class="p">)</span>

            <span class="n">phone_setup_on_rat</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
                <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">rat</span><span class="p">[</span><span class="n">cst_slot</span><span class="p">],</span>
                <span class="n">cst_slot_sub_id</span><span class="p">,</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">wfc_mode</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">toggle_wfc_for_subscription</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cst_slot_sub_id</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">set_wfc_mode_for_subscription</span><span class="p">(</span>
                    <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">wfc_mode</span><span class="p">,</span> <span class="n">cst_slot_sub_id</span><span class="p">):</span>
                    <span class="k">pass</span>

            <span class="k">if</span> <span class="n">force_roaming</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">force_roaming</span><span class="p">(</span><span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cst_slot</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">wait_for_wfc_enabled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">cst_reg_fail</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">cst_reg_fail</span> <span class="o">&gt;=</span> <span class="n">test_cycles</span><span class="o">/</span><span class="mi">10</span><span class="p">:</span>
                    <span class="n">exit_due_to_high_fail_rate</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">cst_reg_end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="n">ims_cst_reg_res</span> <span class="o">=</span> <span class="n">check_ims_cst_reg</span><span class="p">(</span>
                <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">cst_slot</span><span class="p">,</span>
                <span class="n">search_interval</span><span class="o">=</span><span class="p">[</span><span class="n">cst_reg_begin_time</span><span class="p">,</span> <span class="n">cst_reg_end_time</span><span class="p">])</span>

            <span class="k">while</span> <span class="ow">not</span> <span class="n">ims_cst_reg_res</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">cst_reg_end_time</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">WAIT_FOR_CST_REG_TIMEOUT</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">ims_cst_reg_res</span> <span class="o">=</span> <span class="n">check_ims_cst_reg</span><span class="p">(</span>
                    <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">cst_slot</span><span class="p">,</span>
                    <span class="n">search_interval</span><span class="o">=</span><span class="p">[</span><span class="n">cst_reg_begin_time</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()])</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">ims_cst_reg_res</span><span class="p">:</span>
                <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;IMS radio tech is NOT CrossStackEpdg.&#39;</span><span class="p">)</span>
                <span class="n">cst_reg_fail</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">cst_reg_fail</span> <span class="o">&gt;=</span> <span class="n">test_cycles</span><span class="o">/</span><span class="mi">10</span><span class="p">:</span>
                    <span class="n">exit_due_to_high_fail_rate</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">attempt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">CALCULATE_EVERY_N_CYCLES</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="n">attempt</span> <span class="o">==</span> <span class="n">test_cycles</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">exit_due_to_high_fail_rate</span><span class="p">:</span>

                <span class="n">parsing_fail</span> <span class="o">=</span> <span class="n">parse_cst_reg</span><span class="p">(</span>
                    <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cst_slot</span><span class="p">,</span> <span class="n">cst_reg_search_intervals</span><span class="p">)</span>
                <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;====== Failed cycles of CST registration ======&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">each_dict</span> <span class="ow">in</span> <span class="n">parsing_fail</span><span class="p">:</span>
                    <span class="n">print_nested_dict</span><span class="p">(</span><span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">each_dict</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">enable_cst</span><span class="p">(</span><span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">exit_due_to_high_fail_rate</span><span class="p">:</span>
                <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s1">&#39;Test case is stopped due to fail rate is greater than 10%.&#39;</span><span class="p">)</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="kc">True</span>


    <span class="k">def</span> <span class="nf">msim_cst_call_voice</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">mo_slot</span><span class="p">,</span>
            <span class="n">mt_slot</span><span class="p">,</span>
            <span class="n">mo_rat</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
            <span class="n">mt_rat</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
            <span class="n">call_direction</span><span class="o">=</span><span class="s2">&quot;mo&quot;</span><span class="p">,</span>
            <span class="n">wfc_mode</span><span class="o">=</span><span class="n">WFC_MODE_WIFI_PREFERRED</span><span class="p">,</span>
            <span class="n">force_roaming</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">test_cycles</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">call_cycles</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make MO/MT voice call at specific slot in specific RAT with DDS at</span>
<span class="sd">        specific slot.</span>

<span class="sd">        Test step:</span>
<span class="sd">        1. Get sub IDs of specific slots of both MO and MT devices.</span>
<span class="sd">        2. Switch DDS to specific slot.</span>
<span class="sd">        3. Check HTTP connection after DDS switch.</span>
<span class="sd">        4. Set up phones in desired RAT.</span>
<span class="sd">        5. Make voice call.</span>

<span class="sd">        Args:</span>
<span class="sd">            mo_slot: Slot making MO call (0 or 1)</span>
<span class="sd">            mt_slot: Slot receiving MT call (0 or 1)</span>
<span class="sd">            mo_rat: RAT for both slots of MO device</span>
<span class="sd">            mt_rat: RAT for both slots of MT device</span>
<span class="sd">            call_direction: &quot;mo&quot; or &quot;mt&quot;</span>

<span class="sd">        Returns:</span>
<span class="sd">            True in the end. Otherwise the exception TestFailure will be raised.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TestFailure if:</span>
<span class="sd">                1. Invalid sub ID is returned.</span>
<span class="sd">                2. DDS cannot be switched successfully.</span>
<span class="sd">                3. Http connection cannot be verified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ads</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">android_devices</span>
        <span class="k">if</span> <span class="n">call_direction</span> <span class="o">==</span> <span class="s2">&quot;mo&quot;</span><span class="p">:</span>
            <span class="n">ad_mo</span> <span class="o">=</span> <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ad_mt</span> <span class="o">=</span> <span class="n">ads</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ad_mo</span> <span class="o">=</span> <span class="n">ads</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ad_mt</span> <span class="o">=</span> <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">test_cycles</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">test_cycles</span><span class="p">)</span>
        <span class="n">call_cycles</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">call_cycles</span><span class="p">)</span>
        <span class="n">set_location_service</span><span class="p">(</span><span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">cst_reg_search_intervals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cst_reg_fail</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">exit_due_to_high_fail_rate</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">dialed_call_amount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">call_result_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">call_result_cycle_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">test_cycles</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;======&gt; Test cycle </span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1"> &lt;======&#39;</span><span class="p">,</span> <span class="n">attempt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">test_cycles</span><span class="p">)</span>
            <span class="n">cst_reg_begin_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">mo_slot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mo_sub_id</span> <span class="o">=</span> <span class="n">get_subid_from_slot_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ad_mo</span><span class="p">,</span> <span class="n">mo_slot</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mo_sub_id</span> <span class="o">==</span> <span class="n">INVALID_SUB_ID</span><span class="p">:</span>
                    <span class="n">ad_mo</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Failed to get sub ID ar slot </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">mo_slot</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="n">signals</span><span class="o">.</span><span class="n">TestFailure</span><span class="p">(</span>
                        <span class="s1">&#39;Failed&#39;</span><span class="p">,</span>
                        <span class="n">extras</span><span class="o">=</span><span class="p">{</span>
                            <span class="s1">&#39;fail_reason&#39;</span><span class="p">:</span> <span class="s1">&#39;Slot ID </span><span class="si">%s</span><span class="s1"> at slot </span><span class="si">%s</span><span class="s1"> is invalid.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="n">mo_sub_id</span><span class="p">,</span> <span class="n">mo_slot</span><span class="p">)})</span>
                <span class="n">mo_other_sub_id</span> <span class="o">=</span> <span class="n">get_subid_from_slot_index</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ad_mo</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">mo_slot</span><span class="p">)</span>
                <span class="n">set_voice_sub_id</span><span class="p">(</span><span class="n">ad_mo</span><span class="p">,</span> <span class="n">mo_sub_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">enable_cst</span><span class="p">(</span><span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">slot</span><span class="o">=</span><span class="n">mo_slot</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">mo_sub_id</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_subid_on_same_network_of_host_ad</span><span class="p">(</span><span class="n">ads</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mo_sub_id</span> <span class="o">==</span> <span class="n">INVALID_SUB_ID</span><span class="p">:</span>
                    <span class="n">ad_mo</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Failed to get sub ID ar slot </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">mo_slot</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="n">signals</span><span class="o">.</span><span class="n">TestFailure</span><span class="p">(</span>
                        <span class="s1">&#39;Failed&#39;</span><span class="p">,</span>
                        <span class="n">extras</span><span class="o">=</span><span class="p">{</span>
                            <span class="s1">&#39;fail_reason&#39;</span><span class="p">:</span> <span class="s1">&#39;Slot ID </span><span class="si">%s</span><span class="s1"> at slot </span><span class="si">%s</span><span class="s1"> is invalid.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="n">mo_sub_id</span><span class="p">,</span> <span class="n">mo_slot</span><span class="p">)})</span>
                <span class="n">mo_slot</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span>
                <span class="n">set_voice_sub_id</span><span class="p">(</span><span class="n">ad_mo</span><span class="p">,</span> <span class="n">mo_sub_id</span><span class="p">)</span>
            <span class="n">ad_mo</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sub ID for outgoing call at slot </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">mo_slot</span><span class="p">,</span> <span class="n">get_outgoing_voice_sub_id</span><span class="p">(</span><span class="n">ad_mo</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">mt_slot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mt_slot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
                <span class="n">mt_sub_id</span> <span class="o">=</span> <span class="n">get_subid_from_slot_index</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ad_mt</span><span class="p">,</span> <span class="n">mt_slot</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mt_sub_id</span> <span class="o">==</span> <span class="n">INVALID_SUB_ID</span><span class="p">:</span>
                    <span class="n">ad_mt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Failed to get sub ID at slot </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">mt_slot</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="n">signals</span><span class="o">.</span><span class="n">TestFailure</span><span class="p">(</span>
                        <span class="s1">&#39;Failed&#39;</span><span class="p">,</span>
                        <span class="n">extras</span><span class="o">=</span><span class="p">{</span>
                            <span class="s1">&#39;fail_reason&#39;</span><span class="p">:</span> <span class="s1">&#39;Slot ID </span><span class="si">%s</span><span class="s1"> at slot </span><span class="si">%s</span><span class="s1"> is invalid.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="n">mt_sub_id</span><span class="p">,</span> <span class="n">mt_slot</span><span class="p">)})</span>
                <span class="n">mt_other_sub_id</span> <span class="o">=</span> <span class="n">get_subid_from_slot_index</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ad_mt</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">mt_slot</span><span class="p">)</span>
                <span class="n">set_voice_sub_id</span><span class="p">(</span><span class="n">ad_mt</span><span class="p">,</span> <span class="n">mt_sub_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">enable_cst</span><span class="p">(</span><span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">slot</span><span class="o">=</span><span class="n">mt_slot</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">mt_sub_id</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_subid_on_same_network_of_host_ad</span><span class="p">(</span><span class="n">ads</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mt_sub_id</span> <span class="o">==</span> <span class="n">INVALID_SUB_ID</span><span class="p">:</span>
                    <span class="n">ad_mt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Failed to get sub ID at slot </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">mt_slot</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="n">signals</span><span class="o">.</span><span class="n">TestFailure</span><span class="p">(</span>
                        <span class="s1">&#39;Failed&#39;</span><span class="p">,</span>
                        <span class="n">extras</span><span class="o">=</span><span class="p">{</span>
                            <span class="s1">&#39;fail_reason&#39;</span><span class="p">:</span> <span class="s1">&#39;Slot ID </span><span class="si">%s</span><span class="s1"> at slot </span><span class="si">%s</span><span class="s1"> is invalid.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="n">mt_sub_id</span><span class="p">,</span> <span class="n">mt_slot</span><span class="p">)})</span>
                <span class="n">mt_slot</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span>
                <span class="n">set_voice_sub_id</span><span class="p">(</span><span class="n">ad_mt</span><span class="p">,</span> <span class="n">mt_sub_id</span><span class="p">)</span>
            <span class="n">ad_mt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sub ID for incoming call at slot </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mt_slot</span><span class="p">,</span>
                <span class="n">get_incoming_voice_sub_id</span><span class="p">(</span><span class="n">ad_mt</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Step 1: Switch DDS.&quot;</span><span class="p">)</span>

            <span class="n">dds_slot</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">call_direction</span> <span class="o">==</span> <span class="s2">&quot;mo&quot;</span><span class="p">:</span>
                <span class="n">dds_slot</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">get_slot_index_from_subid</span><span class="p">(</span><span class="n">ad_mo</span><span class="p">,</span> <span class="n">mo_sub_id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dds_slot</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">get_slot_index_from_subid</span><span class="p">(</span><span class="n">ad_mt</span><span class="p">,</span> <span class="n">mt_sub_id</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">set_dds_on_slot</span><span class="p">(</span><span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dds_slot</span><span class="p">):</span>
                <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to set DDS to slot </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">dds_slot</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">signals</span><span class="o">.</span><span class="n">TestFailure</span><span class="p">(</span>
                    <span class="s1">&#39;Failed&#39;</span><span class="p">,</span>
                    <span class="n">extras</span><span class="o">=</span><span class="p">{</span>
                        <span class="s1">&#39;fail_reason&#39;</span><span class="p">:</span> <span class="s1">&#39;Failed to set DDS to slot </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="n">dds_slot</span><span class="p">})</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Step 2: Check HTTP connection after DDS switch.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">verify_http_connection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
                <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://www.google.com&quot;</span><span class="p">,</span>
                <span class="n">retry</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                <span class="n">retry_interval</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                <span class="n">expected_state</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to verify http connection.&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">signals</span><span class="o">.</span><span class="n">TestFailure</span><span class="p">(</span>
                    <span class="s1">&#39;Failed&#39;</span><span class="p">,</span>
                    <span class="n">extras</span><span class="o">=</span><span class="p">{</span>
                        <span class="s1">&#39;fail_reason&#39;</span><span class="p">:</span> <span class="s1">&#39;Failed to verify http connection.&#39;</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Verify http connection successfully.&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mo_slot</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">mo_slot</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">phone_setup_on_rat</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
                    <span class="n">ad_mo</span><span class="p">,</span>
                    <span class="n">mo_rat</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="n">mo_slot</span><span class="p">],</span>
                    <span class="n">mo_other_sub_id</span><span class="p">)</span>

                <span class="n">mo_phone_setup_argv</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
                <span class="n">ad_mo</span><span class="p">,</span>
                <span class="n">mo_rat</span><span class="p">[</span><span class="n">mo_slot</span><span class="p">],</span>
                <span class="n">mo_sub_id</span><span class="p">,</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">wfc_mode</span><span class="p">)</span>

                <span class="n">is_mo_in_call</span> <span class="o">=</span> <span class="n">is_phone_in_call_on_rat</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ad_mo</span><span class="p">,</span> <span class="n">mo_rat</span><span class="p">[</span><span class="n">mo_slot</span><span class="p">],</span> <span class="n">only_return_fn</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mo_phone_setup_argv</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ad_mo</span><span class="p">,</span> <span class="s1">&#39;general&#39;</span><span class="p">)</span>
                <span class="n">is_mo_in_call</span> <span class="o">=</span> <span class="n">is_phone_in_call_on_rat</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ad_mo</span><span class="p">,</span> <span class="s1">&#39;general&#39;</span><span class="p">,</span> <span class="n">only_return_fn</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mt_slot</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">mt_slot</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">phone_setup_on_rat</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
                    <span class="n">ad_mt</span><span class="p">,</span>
                    <span class="n">mt_rat</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="n">mt_slot</span><span class="p">],</span>
                    <span class="n">mt_other_sub_id</span><span class="p">)</span>

                <span class="n">mt_phone_setup_argv</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
                <span class="n">ad_mt</span><span class="p">,</span>
                <span class="n">mt_rat</span><span class="p">[</span><span class="n">mt_slot</span><span class="p">],</span>
                <span class="n">mt_sub_id</span><span class="p">,</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">wfc_mode</span><span class="p">)</span>

                <span class="n">is_mt_in_call</span> <span class="o">=</span> <span class="n">is_phone_in_call_on_rat</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ad_mt</span><span class="p">,</span> <span class="n">mt_rat</span><span class="p">[</span><span class="n">mt_slot</span><span class="p">],</span> <span class="n">only_return_fn</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mt_phone_setup_argv</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ad_mt</span><span class="p">,</span> <span class="s1">&#39;general&#39;</span><span class="p">)</span>
                <span class="n">is_mt_in_call</span> <span class="o">=</span> <span class="n">is_phone_in_call_on_rat</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ad_mt</span><span class="p">,</span> <span class="s1">&#39;general&#39;</span><span class="p">,</span> <span class="n">only_return_fn</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Step 3: Set up phones in desired RAT.&quot;</span><span class="p">)</span>

            <span class="n">tasks</span> <span class="o">=</span> <span class="p">[(</span><span class="n">phone_setup_on_rat</span><span class="p">,</span> <span class="n">mo_phone_setup_argv</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">phone_setup_on_rat</span><span class="p">,</span> <span class="n">mt_phone_setup_argv</span><span class="p">)]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">multithread_func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">tasks</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Phone Failed to Set Up Properly.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tel_logger</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="n">CallResult</span><span class="p">(</span><span class="s2">&quot;CALL_SETUP_FAILURE&quot;</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">signals</span><span class="o">.</span><span class="n">TestFailure</span><span class="p">(</span><span class="s2">&quot;Failed&quot;</span><span class="p">,</span>
                    <span class="n">extras</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fail_reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Phone Failed to Set Up Properly.&quot;</span><span class="p">})</span>

            <span class="k">if</span> <span class="n">toggle_wfc_for_subscription</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ad_mo</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">mo_sub_id</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">set_wfc_mode_for_subscription</span><span class="p">(</span><span class="n">ad_mo</span><span class="p">,</span> <span class="n">wfc_mode</span><span class="p">,</span> <span class="n">mo_sub_id</span><span class="p">):</span>
                    <span class="k">pass</span>

            <span class="k">if</span> <span class="n">force_roaming</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">force_roaming</span><span class="p">(</span><span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="o">-</span><span class="n">dds_slot</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">wait_for_wfc_enabled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">cst_reg_fail</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">cst_reg_fail</span> <span class="o">&gt;=</span> <span class="n">test_cycles</span><span class="o">/</span><span class="mi">10</span><span class="p">:</span>
                    <span class="n">exit_due_to_high_fail_rate</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">cst_reg_end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="n">ims_cst_reg_res</span> <span class="o">=</span> <span class="n">check_ims_cst_reg</span><span class="p">(</span>
                <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="mi">1</span><span class="o">-</span><span class="n">dds_slot</span><span class="p">,</span>
                <span class="n">search_interval</span><span class="o">=</span><span class="p">[</span><span class="n">cst_reg_begin_time</span><span class="p">,</span> <span class="n">cst_reg_end_time</span><span class="p">])</span>

            <span class="k">while</span> <span class="ow">not</span> <span class="n">ims_cst_reg_res</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">cst_reg_end_time</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">WAIT_FOR_CST_REG_TIMEOUT</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">ims_cst_reg_res</span> <span class="o">=</span> <span class="n">check_ims_cst_reg</span><span class="p">(</span>
                    <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="mi">1</span><span class="o">-</span><span class="n">dds_slot</span><span class="p">,</span>
                    <span class="n">search_interval</span><span class="o">=</span><span class="p">[</span><span class="n">cst_reg_begin_time</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()])</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">ims_cst_reg_res</span><span class="p">:</span>
                <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;IMS radio tech is NOT CrossStackEpdg.&#39;</span><span class="p">)</span>
                <span class="n">cst_reg_fail</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">cst_reg_fail</span> <span class="o">&gt;=</span> <span class="n">test_cycles</span><span class="o">/</span><span class="mi">10</span><span class="p">:</span>
                    <span class="n">exit_due_to_high_fail_rate</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">ims_cst_reg_res</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">exit_due_to_high_fail_rate</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Step 4: Make voice call.&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">cycle</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                    <span class="n">dialed_call_amount</span><span class="p">,</span> <span class="n">dialed_call_amount</span><span class="o">+</span><span class="n">call_cycles</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s1">&#39;======&gt; CST voice call </span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1"> &lt;======&#39;</span><span class="p">,</span>
                        <span class="n">cycle</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">dialed_call_amount</span><span class="o">+</span><span class="n">call_cycles</span><span class="p">)</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">two_phone_call_msim_for_slot</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
                        <span class="n">ad_mo</span><span class="p">,</span>
                        <span class="n">get_slot_index_from_subid</span><span class="p">(</span><span class="n">ad_mo</span><span class="p">,</span> <span class="n">mo_sub_id</span><span class="p">),</span>
                        <span class="kc">None</span><span class="p">,</span>
                        <span class="n">is_mo_in_call</span><span class="p">,</span>
                        <span class="n">ad_mt</span><span class="p">,</span>
                        <span class="n">get_slot_index_from_subid</span><span class="p">(</span><span class="n">ad_mt</span><span class="p">,</span> <span class="n">mt_sub_id</span><span class="p">),</span>
                        <span class="kc">None</span><span class="p">,</span>
                        <span class="n">is_mt_in_call</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tel_logger</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">result_value</span><span class="p">)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                            <span class="s2">&quot;Failed to make MO call from </span><span class="si">%s</span><span class="s2"> slot </span><span class="si">%s</span><span class="s2"> to </span><span class="si">%s</span><span class="s2"> slot </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">ad_mo</span><span class="o">.</span><span class="n">serial</span><span class="p">,</span> <span class="n">mo_slot</span><span class="p">,</span> <span class="n">ad_mt</span><span class="o">.</span><span class="n">serial</span><span class="p">,</span> <span class="n">mt_slot</span><span class="p">)</span>
                        <span class="n">call_result_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                        <span class="n">call_result_cycle_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cycle</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_take_bug_report</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">test_name</span><span class="p">,</span> <span class="n">begin_time</span><span class="o">=</span><span class="n">get_current_epoch_time</span><span class="p">())</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">call_result_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">dialed_call_amount</span> <span class="o">=</span> <span class="n">dialed_call_amount</span> <span class="o">+</span> <span class="n">call_cycles</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">attempt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">CALCULATE_EVERY_N_CYCLES</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="n">attempt</span> <span class="o">==</span> <span class="n">test_cycles</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">exit_due_to_high_fail_rate</span><span class="p">:</span>

                <span class="n">parsing_fail</span> <span class="o">=</span> <span class="n">parse_cst_reg</span><span class="p">(</span>
                    <span class="n">ad_mo</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">dds_slot</span><span class="p">,</span> <span class="n">cst_reg_search_intervals</span><span class="p">)</span>
                <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;====== Failed cycles of CST registration ======&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">each_dict</span> <span class="ow">in</span> <span class="n">parsing_fail</span><span class="p">:</span>
                    <span class="n">print_nested_dict</span><span class="p">(</span><span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">each_dict</span><span class="p">)</span>

                <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;====== Failed cycles of CST voice call ======&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">call_result_list</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
                        <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                            <span class="s1">&#39;CST voice call cycle </span><span class="si">%s</span><span class="s1"> failed.&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">fail_rate</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="nb">len</span><span class="p">(</span><span class="n">call_result_list</span><span class="p">)</span> <span class="o">-</span> <span class="n">call_result_list</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span>
                            <span class="n">call_result_list</span><span class="p">)</span>
                    <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;====== Summary ======&#39;</span><span class="p">)</span>
                    <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s1">&#39;Total CST calls: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="nb">len</span><span class="p">(</span><span class="n">call_result_list</span><span class="p">))</span>
                    <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s1">&#39;Total failed CST calls: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">call_result_list</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">False</span><span class="p">))</span>
                    <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s1">&#39;Fail rate of CST voice call: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fail_rate</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="s1">&#39;Fail rate of CST voice call: ERROR (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">enable_cst</span><span class="p">(</span><span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">exit_due_to_high_fail_rate</span><span class="p">:</span>
                <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s1">&#39;Test case is stopped due to fail rate is greater than 10%.&#39;</span><span class="p">)</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="kc">True</span>


    <span class="nd">@test_tracker_info</span><span class="p">(</span><span class="n">uuid</span><span class="o">=</span><span class="s2">&quot;5475514a-8897-4dd4-900f-1dd435191d0b&quot;</span><span class="p">)</span>
    <span class="nd">@TelephonyBaseTest</span><span class="o">.</span><span class="n">tel_test_wrap</span>
    <span class="k">def</span> <span class="nf">test_msim_psim_mo_cst_call_wifi_preferred</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">msim_cst_call_voice</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="n">mo_rat</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;2g&quot;</span><span class="p">,</span> <span class="s2">&quot;general&quot;</span><span class="p">],</span>
            <span class="n">call_direction</span><span class="o">=</span><span class="s2">&quot;mo&quot;</span><span class="p">,</span>
            <span class="n">test_cycles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;psim_mo_cst_call_wifi_preferred_test_cycle&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">call_cycles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cst_call_cycle&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>


    <span class="nd">@test_tracker_info</span><span class="p">(</span><span class="n">uuid</span><span class="o">=</span><span class="s2">&quot;40c182b7-af25-428a-bae5-9203eed949d8&quot;</span><span class="p">)</span>
    <span class="nd">@TelephonyBaseTest</span><span class="o">.</span><span class="n">tel_test_wrap</span>
    <span class="k">def</span> <span class="nf">test_msim_psim_mo_cst_call_cellular_preferred</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">msim_cst_call_voice</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="n">mo_rat</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;2g&quot;</span><span class="p">,</span> <span class="s2">&quot;general&quot;</span><span class="p">],</span>
            <span class="n">call_direction</span><span class="o">=</span><span class="s2">&quot;mo&quot;</span><span class="p">,</span>
            <span class="n">wfc_mode</span><span class="o">=</span><span class="n">WFC_MODE_CELLULAR_PREFERRED</span><span class="p">,</span>
            <span class="n">test_cycles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;psim_mo_cst_call_cellular_preferred_test_cycle&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">call_cycles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cst_call_cycle&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tests.google.tel.live.TelLiveRilCstVoiceTest.TelLiveRilCstVoiceTest.enable_cst" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">enable_cst</span><span class="p">(</span><span class="n">ad</span><span class="p">,</span> <span class="n">slot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Enable/disable Cross SIM Calling by SL4A API at given slot</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>ad</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Android object</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>slot</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>0 for pSIM and 1 for eSIM</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>enable</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True fo enabling and False for disabling</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tests/google/tel/live/TelLiveRilCstVoiceTest.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">enable_cst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ad</span><span class="p">,</span> <span class="n">slot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Enable/disable Cross SIM Calling by SL4A API at given slot</span>

<span class="sd">        Args:</span>
<span class="sd">            ad: Android object</span>
<span class="sd">            slot: 0 for pSIM and 1 for eSIM</span>
<span class="sd">            enable: True fo enabling and False for disabling</span>

<span class="sd">        Raises:</span>
<span class="sd">            TestFailure if False is returned by</span>
<span class="sd">            imsMmTelIsCrossSimCallingEnabled.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">slot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="p">[</span><span class="n">slot</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">slots</span><span class="p">:</span>
        <span class="n">sub_id</span> <span class="o">=</span> <span class="n">get_subid_from_slot_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ad</span><span class="p">,</span> <span class="n">slot</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ad</span><span class="o">.</span><span class="n">droid</span><span class="o">.</span><span class="n">imsMmTelIsCrossSimCallingEnabled</span><span class="p">(</span><span class="n">sub_id</span><span class="p">)</span> <span class="o">==</span> <span class="n">enable</span><span class="p">:</span>
            <span class="n">ad</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;Status of backup calling at slot </span><span class="si">%s</span><span class="s1"> is already </span><span class="si">%s</span><span class="s1">.&#39;</span><span class="p">,</span>
                <span class="n">slot</span><span class="p">,</span> <span class="n">enable</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ad</span><span class="o">.</span><span class="n">droid</span><span class="o">.</span><span class="n">imsMmTelSetCrossSimCallingEnabled</span><span class="p">(</span><span class="n">sub_id</span><span class="p">,</span> <span class="n">enable</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ad</span><span class="o">.</span><span class="n">droid</span><span class="o">.</span><span class="n">imsMmTelIsCrossSimCallingEnabled</span><span class="p">(</span><span class="n">sub_id</span><span class="p">)</span> <span class="o">==</span> <span class="n">enable</span><span class="p">:</span>
                <span class="n">ad</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s1">&#39;Backup calling at slot </span><span class="si">%s</span><span class="s1"> is set to </span><span class="si">%s</span><span class="s1"> successfully.&#39;</span><span class="p">,</span>
                    <span class="n">slot</span><span class="p">,</span> <span class="n">enable</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ad</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s1">&#39;Backup calling at slot </span><span class="si">%s</span><span class="s1"> is NOT set to </span><span class="si">%s</span><span class="s1">.&#39;</span><span class="p">,</span>
                    <span class="n">slot</span><span class="p">,</span> <span class="n">enable</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">signals</span><span class="o">.</span><span class="n">TestFailure</span><span class="p">(</span>
                    <span class="s2">&quot;Failed&quot;</span><span class="p">,</span>
                    <span class="n">extras</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fail_reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Failed to set Backup calling.&quot;</span><span class="p">})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tests.google.tel.live.TelLiveRilCstVoiceTest.TelLiveRilCstVoiceTest.force_roaming" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">force_roaming</span><span class="p">(</span><span class="n">ad</span><span class="p">,</span> <span class="n">slot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">roaming</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Force assigned slot to roam ot not to roam by setting specific property</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>ad</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Android object</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>slot</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>0 for pSIM and 1 for eSIM</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>roaming</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1 to force to roam. Otherwise 0.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True or False</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tests/google/tel/live/TelLiveRilCstVoiceTest.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">force_roaming</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ad</span><span class="p">,</span> <span class="n">slot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">roaming</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Force assigned slot to roam ot not to roam by setting specific property</span>

<span class="sd">        Args:</span>
<span class="sd">            ad: Android object</span>
<span class="sd">            slot: 0 for pSIM and 1 for eSIM</span>
<span class="sd">            roaming: 1 to force to roam. Otherwise 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True or False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">slot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="p">[</span><span class="n">slot</span><span class="p">]</span>

    <span class="n">need_reboot</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">slots</span><span class="p">:</span>
        <span class="n">roamimg_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_force_roaming_state</span><span class="p">(</span><span class="n">ad</span><span class="p">,</span> <span class="n">slot</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">roamimg_state</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">roamimg_state</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">roaming</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">roaming</span><span class="p">:</span>
                    <span class="n">ad</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Slot </span><span class="si">%s</span><span class="s1"> is already roaming.&#39;</span> <span class="o">%</span> <span class="n">slot</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ad</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Slot </span><span class="si">%s</span><span class="s1"> is already on home network.&#39;</span> <span class="o">%</span> <span class="n">slot</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;adb -s </span><span class="si">%s</span><span class="s1"> shell setprop persist.vendor.radio.force_roaming</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ad</span><span class="o">.</span><span class="n">serial</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">roaming</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="n">need_reboot</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">need_reboot</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">reboot_test</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ad</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">slots</span><span class="p">:</span>
                <span class="n">roamimg_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_force_roaming_state</span><span class="p">(</span><span class="n">ad</span><span class="p">,</span> <span class="n">slot</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">roamimg_state</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">roaming</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">roaming</span><span class="p">:</span>
                        <span class="n">ad</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Slot </span><span class="si">%s</span><span class="s1"> is now roaming.&#39;</span> <span class="o">%</span> <span class="n">slot</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ad</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Slot </span><span class="si">%s</span><span class="s1"> is now on home network.&#39;</span> <span class="o">%</span> <span class="n">slot</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">roaming</span><span class="p">:</span>
                        <span class="n">ad</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                            <span class="s1">&#39;Slot </span><span class="si">%s</span><span class="s1"> is expected to be roaming (roamimg state: </span><span class="si">%s</span><span class="s1">).&#39;</span> <span class="o">%</span> <span class="n">roamimg_state</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ad</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                            <span class="s1">&#39;Slot </span><span class="si">%s</span><span class="s1"> is expected to be on home network (roamimg state: </span><span class="si">%s</span><span class="s1">).&#39;</span> <span class="o">%</span> <span class="n">roamimg_state</span><span class="p">)</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tests.google.tel.live.TelLiveRilCstVoiceTest.TelLiveRilCstVoiceTest.get_force_roaming_state" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_force_roaming_state</span><span class="p">(</span><span class="n">ad</span><span class="p">,</span> <span class="n">slot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<details class="get-the-value-of-the-property" open>
  <summary>Get the value of the property</summary>
  <p>getprop persist.vendor.radio.force_roaming</p>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>ad</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Android object</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>slot</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>0 for pSIM and 1 for eSIM</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>0 for not roaming and 1 for roaming</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tests/google/tel/live/TelLiveRilCstVoiceTest.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_force_roaming_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ad</span><span class="p">,</span> <span class="n">slot</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the value of the property:</span>
<span class="sd">            getprop persist.vendor.radio.force_roaming</span>

<span class="sd">        Args:</span>
<span class="sd">            ad: Android object</span>
<span class="sd">            slot: 0 for pSIM and 1 for eSIM</span>

<span class="sd">        Returns:</span>
<span class="sd">            0 for not roaming and 1 for roaming</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;adb -s </span><span class="si">%s</span><span class="s1"> shell getprop persist.vendor.radio.force_roaming</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="n">ad</span><span class="o">.</span><span class="n">serial</span><span class="p">,</span> <span class="n">slot</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tests.google.tel.live.TelLiveRilCstVoiceTest.TelLiveRilCstVoiceTest.msim_cst_call_voice" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">msim_cst_call_voice</span><span class="p">(</span><span class="n">mo_slot</span><span class="p">,</span> <span class="n">mt_slot</span><span class="p">,</span> <span class="n">mo_rat</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">],</span> <span class="n">mt_rat</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">],</span> <span class="n">call_direction</span><span class="o">=</span><span class="s1">&#39;mo&#39;</span><span class="p">,</span> <span class="n">wfc_mode</span><span class="o">=</span><span class="n">WFC_MODE_WIFI_PREFERRED</span><span class="p">,</span> <span class="n">force_roaming</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">test_cycles</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">call_cycles</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Make MO/MT voice call at specific slot in specific RAT with DDS at
specific slot.</p>
<p>Test step:
1. Get sub IDs of specific slots of both MO and MT devices.
2. Switch DDS to specific slot.
3. Check HTTP connection after DDS switch.
4. Set up phones in desired RAT.
5. Make voice call.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>mo_slot</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Slot making MO call (0 or 1)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>mt_slot</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Slot receiving MT call (0 or 1)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>mo_rat</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>RAT for both slots of MO device</p>
              </div>
            </td>
            <td>
                  <code>[&#39;&#39;, &#39;&#39;]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>mt_rat</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>RAT for both slots of MT device</p>
              </div>
            </td>
            <td>
                  <code>[&#39;&#39;, &#39;&#39;]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>call_direction</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>"mo" or "mt"</p>
              </div>
            </td>
            <td>
                  <code>&#39;mo&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True in the end. Otherwise the exception TestFailure will be raised.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>TestFailure if</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ol>
<li>Invalid sub ID is returned.</li>
<li>DDS cannot be switched successfully.</li>
<li>Http connection cannot be verified.</li>
</ol>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tests/google/tel/live/TelLiveRilCstVoiceTest.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">msim_cst_call_voice</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mo_slot</span><span class="p">,</span>
        <span class="n">mt_slot</span><span class="p">,</span>
        <span class="n">mo_rat</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="n">mt_rat</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="n">call_direction</span><span class="o">=</span><span class="s2">&quot;mo&quot;</span><span class="p">,</span>
        <span class="n">wfc_mode</span><span class="o">=</span><span class="n">WFC_MODE_WIFI_PREFERRED</span><span class="p">,</span>
        <span class="n">force_roaming</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">test_cycles</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">call_cycles</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make MO/MT voice call at specific slot in specific RAT with DDS at</span>
<span class="sd">    specific slot.</span>

<span class="sd">    Test step:</span>
<span class="sd">    1. Get sub IDs of specific slots of both MO and MT devices.</span>
<span class="sd">    2. Switch DDS to specific slot.</span>
<span class="sd">    3. Check HTTP connection after DDS switch.</span>
<span class="sd">    4. Set up phones in desired RAT.</span>
<span class="sd">    5. Make voice call.</span>

<span class="sd">    Args:</span>
<span class="sd">        mo_slot: Slot making MO call (0 or 1)</span>
<span class="sd">        mt_slot: Slot receiving MT call (0 or 1)</span>
<span class="sd">        mo_rat: RAT for both slots of MO device</span>
<span class="sd">        mt_rat: RAT for both slots of MT device</span>
<span class="sd">        call_direction: &quot;mo&quot; or &quot;mt&quot;</span>

<span class="sd">    Returns:</span>
<span class="sd">        True in the end. Otherwise the exception TestFailure will be raised.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TestFailure if:</span>
<span class="sd">            1. Invalid sub ID is returned.</span>
<span class="sd">            2. DDS cannot be switched successfully.</span>
<span class="sd">            3. Http connection cannot be verified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ads</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">android_devices</span>
    <span class="k">if</span> <span class="n">call_direction</span> <span class="o">==</span> <span class="s2">&quot;mo&quot;</span><span class="p">:</span>
        <span class="n">ad_mo</span> <span class="o">=</span> <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ad_mt</span> <span class="o">=</span> <span class="n">ads</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ad_mo</span> <span class="o">=</span> <span class="n">ads</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ad_mt</span> <span class="o">=</span> <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">test_cycles</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">test_cycles</span><span class="p">)</span>
    <span class="n">call_cycles</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">call_cycles</span><span class="p">)</span>
    <span class="n">set_location_service</span><span class="p">(</span><span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">cst_reg_search_intervals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cst_reg_fail</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">exit_due_to_high_fail_rate</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">dialed_call_amount</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">call_result_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">call_result_cycle_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">test_cycles</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;======&gt; Test cycle </span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1"> &lt;======&#39;</span><span class="p">,</span> <span class="n">attempt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">test_cycles</span><span class="p">)</span>
        <span class="n">cst_reg_begin_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mo_slot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mo_sub_id</span> <span class="o">=</span> <span class="n">get_subid_from_slot_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ad_mo</span><span class="p">,</span> <span class="n">mo_slot</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mo_sub_id</span> <span class="o">==</span> <span class="n">INVALID_SUB_ID</span><span class="p">:</span>
                <span class="n">ad_mo</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to get sub ID ar slot </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">mo_slot</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">signals</span><span class="o">.</span><span class="n">TestFailure</span><span class="p">(</span>
                    <span class="s1">&#39;Failed&#39;</span><span class="p">,</span>
                    <span class="n">extras</span><span class="o">=</span><span class="p">{</span>
                        <span class="s1">&#39;fail_reason&#39;</span><span class="p">:</span> <span class="s1">&#39;Slot ID </span><span class="si">%s</span><span class="s1"> at slot </span><span class="si">%s</span><span class="s1"> is invalid.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="n">mo_sub_id</span><span class="p">,</span> <span class="n">mo_slot</span><span class="p">)})</span>
            <span class="n">mo_other_sub_id</span> <span class="o">=</span> <span class="n">get_subid_from_slot_index</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ad_mo</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">mo_slot</span><span class="p">)</span>
            <span class="n">set_voice_sub_id</span><span class="p">(</span><span class="n">ad_mo</span><span class="p">,</span> <span class="n">mo_sub_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable_cst</span><span class="p">(</span><span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">slot</span><span class="o">=</span><span class="n">mo_slot</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">mo_sub_id</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_subid_on_same_network_of_host_ad</span><span class="p">(</span><span class="n">ads</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mo_sub_id</span> <span class="o">==</span> <span class="n">INVALID_SUB_ID</span><span class="p">:</span>
                <span class="n">ad_mo</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to get sub ID ar slot </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">mo_slot</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">signals</span><span class="o">.</span><span class="n">TestFailure</span><span class="p">(</span>
                    <span class="s1">&#39;Failed&#39;</span><span class="p">,</span>
                    <span class="n">extras</span><span class="o">=</span><span class="p">{</span>
                        <span class="s1">&#39;fail_reason&#39;</span><span class="p">:</span> <span class="s1">&#39;Slot ID </span><span class="si">%s</span><span class="s1"> at slot </span><span class="si">%s</span><span class="s1"> is invalid.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="n">mo_sub_id</span><span class="p">,</span> <span class="n">mo_slot</span><span class="p">)})</span>
            <span class="n">mo_slot</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span>
            <span class="n">set_voice_sub_id</span><span class="p">(</span><span class="n">ad_mo</span><span class="p">,</span> <span class="n">mo_sub_id</span><span class="p">)</span>
        <span class="n">ad_mo</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sub ID for outgoing call at slot </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">mo_slot</span><span class="p">,</span> <span class="n">get_outgoing_voice_sub_id</span><span class="p">(</span><span class="n">ad_mo</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">mt_slot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mt_slot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
            <span class="n">mt_sub_id</span> <span class="o">=</span> <span class="n">get_subid_from_slot_index</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ad_mt</span><span class="p">,</span> <span class="n">mt_slot</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mt_sub_id</span> <span class="o">==</span> <span class="n">INVALID_SUB_ID</span><span class="p">:</span>
                <span class="n">ad_mt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to get sub ID at slot </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">mt_slot</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">signals</span><span class="o">.</span><span class="n">TestFailure</span><span class="p">(</span>
                    <span class="s1">&#39;Failed&#39;</span><span class="p">,</span>
                    <span class="n">extras</span><span class="o">=</span><span class="p">{</span>
                        <span class="s1">&#39;fail_reason&#39;</span><span class="p">:</span> <span class="s1">&#39;Slot ID </span><span class="si">%s</span><span class="s1"> at slot </span><span class="si">%s</span><span class="s1"> is invalid.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="n">mt_sub_id</span><span class="p">,</span> <span class="n">mt_slot</span><span class="p">)})</span>
            <span class="n">mt_other_sub_id</span> <span class="o">=</span> <span class="n">get_subid_from_slot_index</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ad_mt</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">mt_slot</span><span class="p">)</span>
            <span class="n">set_voice_sub_id</span><span class="p">(</span><span class="n">ad_mt</span><span class="p">,</span> <span class="n">mt_sub_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable_cst</span><span class="p">(</span><span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">slot</span><span class="o">=</span><span class="n">mt_slot</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">mt_sub_id</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_subid_on_same_network_of_host_ad</span><span class="p">(</span><span class="n">ads</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mt_sub_id</span> <span class="o">==</span> <span class="n">INVALID_SUB_ID</span><span class="p">:</span>
                <span class="n">ad_mt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to get sub ID at slot </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">mt_slot</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">signals</span><span class="o">.</span><span class="n">TestFailure</span><span class="p">(</span>
                    <span class="s1">&#39;Failed&#39;</span><span class="p">,</span>
                    <span class="n">extras</span><span class="o">=</span><span class="p">{</span>
                        <span class="s1">&#39;fail_reason&#39;</span><span class="p">:</span> <span class="s1">&#39;Slot ID </span><span class="si">%s</span><span class="s1"> at slot </span><span class="si">%s</span><span class="s1"> is invalid.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="n">mt_sub_id</span><span class="p">,</span> <span class="n">mt_slot</span><span class="p">)})</span>
            <span class="n">mt_slot</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span>
            <span class="n">set_voice_sub_id</span><span class="p">(</span><span class="n">ad_mt</span><span class="p">,</span> <span class="n">mt_sub_id</span><span class="p">)</span>
        <span class="n">ad_mt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sub ID for incoming call at slot </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mt_slot</span><span class="p">,</span>
            <span class="n">get_incoming_voice_sub_id</span><span class="p">(</span><span class="n">ad_mt</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Step 1: Switch DDS.&quot;</span><span class="p">)</span>

        <span class="n">dds_slot</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">call_direction</span> <span class="o">==</span> <span class="s2">&quot;mo&quot;</span><span class="p">:</span>
            <span class="n">dds_slot</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">get_slot_index_from_subid</span><span class="p">(</span><span class="n">ad_mo</span><span class="p">,</span> <span class="n">mo_sub_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dds_slot</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">get_slot_index_from_subid</span><span class="p">(</span><span class="n">ad_mt</span><span class="p">,</span> <span class="n">mt_sub_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">set_dds_on_slot</span><span class="p">(</span><span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dds_slot</span><span class="p">):</span>
            <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to set DDS to slot </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">dds_slot</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">signals</span><span class="o">.</span><span class="n">TestFailure</span><span class="p">(</span>
                <span class="s1">&#39;Failed&#39;</span><span class="p">,</span>
                <span class="n">extras</span><span class="o">=</span><span class="p">{</span>
                    <span class="s1">&#39;fail_reason&#39;</span><span class="p">:</span> <span class="s1">&#39;Failed to set DDS to slot </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="n">dds_slot</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Step 2: Check HTTP connection after DDS switch.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">verify_http_connection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
            <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://www.google.com&quot;</span><span class="p">,</span>
            <span class="n">retry</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">retry_interval</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
            <span class="n">expected_state</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to verify http connection.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">signals</span><span class="o">.</span><span class="n">TestFailure</span><span class="p">(</span>
                <span class="s1">&#39;Failed&#39;</span><span class="p">,</span>
                <span class="n">extras</span><span class="o">=</span><span class="p">{</span>
                    <span class="s1">&#39;fail_reason&#39;</span><span class="p">:</span> <span class="s1">&#39;Failed to verify http connection.&#39;</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Verify http connection successfully.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mo_slot</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">mo_slot</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">phone_setup_on_rat</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
                <span class="n">ad_mo</span><span class="p">,</span>
                <span class="n">mo_rat</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="n">mo_slot</span><span class="p">],</span>
                <span class="n">mo_other_sub_id</span><span class="p">)</span>

            <span class="n">mo_phone_setup_argv</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
            <span class="n">ad_mo</span><span class="p">,</span>
            <span class="n">mo_rat</span><span class="p">[</span><span class="n">mo_slot</span><span class="p">],</span>
            <span class="n">mo_sub_id</span><span class="p">,</span>
            <span class="kc">False</span><span class="p">,</span>
            <span class="n">wfc_mode</span><span class="p">)</span>

            <span class="n">is_mo_in_call</span> <span class="o">=</span> <span class="n">is_phone_in_call_on_rat</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ad_mo</span><span class="p">,</span> <span class="n">mo_rat</span><span class="p">[</span><span class="n">mo_slot</span><span class="p">],</span> <span class="n">only_return_fn</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mo_phone_setup_argv</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ad_mo</span><span class="p">,</span> <span class="s1">&#39;general&#39;</span><span class="p">)</span>
            <span class="n">is_mo_in_call</span> <span class="o">=</span> <span class="n">is_phone_in_call_on_rat</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ad_mo</span><span class="p">,</span> <span class="s1">&#39;general&#39;</span><span class="p">,</span> <span class="n">only_return_fn</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mt_slot</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">mt_slot</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">phone_setup_on_rat</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
                <span class="n">ad_mt</span><span class="p">,</span>
                <span class="n">mt_rat</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="n">mt_slot</span><span class="p">],</span>
                <span class="n">mt_other_sub_id</span><span class="p">)</span>

            <span class="n">mt_phone_setup_argv</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
            <span class="n">ad_mt</span><span class="p">,</span>
            <span class="n">mt_rat</span><span class="p">[</span><span class="n">mt_slot</span><span class="p">],</span>
            <span class="n">mt_sub_id</span><span class="p">,</span>
            <span class="kc">False</span><span class="p">,</span>
            <span class="n">wfc_mode</span><span class="p">)</span>

            <span class="n">is_mt_in_call</span> <span class="o">=</span> <span class="n">is_phone_in_call_on_rat</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ad_mt</span><span class="p">,</span> <span class="n">mt_rat</span><span class="p">[</span><span class="n">mt_slot</span><span class="p">],</span> <span class="n">only_return_fn</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mt_phone_setup_argv</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ad_mt</span><span class="p">,</span> <span class="s1">&#39;general&#39;</span><span class="p">)</span>
            <span class="n">is_mt_in_call</span> <span class="o">=</span> <span class="n">is_phone_in_call_on_rat</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ad_mt</span><span class="p">,</span> <span class="s1">&#39;general&#39;</span><span class="p">,</span> <span class="n">only_return_fn</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Step 3: Set up phones in desired RAT.&quot;</span><span class="p">)</span>

        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[(</span><span class="n">phone_setup_on_rat</span><span class="p">,</span> <span class="n">mo_phone_setup_argv</span><span class="p">),</span>
                <span class="p">(</span><span class="n">phone_setup_on_rat</span><span class="p">,</span> <span class="n">mt_phone_setup_argv</span><span class="p">)]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">multithread_func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">tasks</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Phone Failed to Set Up Properly.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tel_logger</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="n">CallResult</span><span class="p">(</span><span class="s2">&quot;CALL_SETUP_FAILURE&quot;</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">signals</span><span class="o">.</span><span class="n">TestFailure</span><span class="p">(</span><span class="s2">&quot;Failed&quot;</span><span class="p">,</span>
                <span class="n">extras</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fail_reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Phone Failed to Set Up Properly.&quot;</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">toggle_wfc_for_subscription</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ad_mo</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">mo_sub_id</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">set_wfc_mode_for_subscription</span><span class="p">(</span><span class="n">ad_mo</span><span class="p">,</span> <span class="n">wfc_mode</span><span class="p">,</span> <span class="n">mo_sub_id</span><span class="p">):</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="n">force_roaming</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">force_roaming</span><span class="p">(</span><span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="o">-</span><span class="n">dds_slot</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">wait_for_wfc_enabled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">cst_reg_fail</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">cst_reg_fail</span> <span class="o">&gt;=</span> <span class="n">test_cycles</span><span class="o">/</span><span class="mi">10</span><span class="p">:</span>
                <span class="n">exit_due_to_high_fail_rate</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">cst_reg_end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">ims_cst_reg_res</span> <span class="o">=</span> <span class="n">check_ims_cst_reg</span><span class="p">(</span>
            <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="mi">1</span><span class="o">-</span><span class="n">dds_slot</span><span class="p">,</span>
            <span class="n">search_interval</span><span class="o">=</span><span class="p">[</span><span class="n">cst_reg_begin_time</span><span class="p">,</span> <span class="n">cst_reg_end_time</span><span class="p">])</span>

        <span class="k">while</span> <span class="ow">not</span> <span class="n">ims_cst_reg_res</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">cst_reg_end_time</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">WAIT_FOR_CST_REG_TIMEOUT</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ims_cst_reg_res</span> <span class="o">=</span> <span class="n">check_ims_cst_reg</span><span class="p">(</span>
                <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="mi">1</span><span class="o">-</span><span class="n">dds_slot</span><span class="p">,</span>
                <span class="n">search_interval</span><span class="o">=</span><span class="p">[</span><span class="n">cst_reg_begin_time</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ims_cst_reg_res</span><span class="p">:</span>
            <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;IMS radio tech is NOT CrossStackEpdg.&#39;</span><span class="p">)</span>
            <span class="n">cst_reg_fail</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">cst_reg_fail</span> <span class="o">&gt;=</span> <span class="n">test_cycles</span><span class="o">/</span><span class="mi">10</span><span class="p">:</span>
                <span class="n">exit_due_to_high_fail_rate</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">ims_cst_reg_res</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">exit_due_to_high_fail_rate</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Step 4: Make voice call.&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cycle</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                <span class="n">dialed_call_amount</span><span class="p">,</span> <span class="n">dialed_call_amount</span><span class="o">+</span><span class="n">call_cycles</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s1">&#39;======&gt; CST voice call </span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1"> &lt;======&#39;</span><span class="p">,</span>
                    <span class="n">cycle</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">dialed_call_amount</span><span class="o">+</span><span class="n">call_cycles</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">two_phone_call_msim_for_slot</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
                    <span class="n">ad_mo</span><span class="p">,</span>
                    <span class="n">get_slot_index_from_subid</span><span class="p">(</span><span class="n">ad_mo</span><span class="p">,</span> <span class="n">mo_sub_id</span><span class="p">),</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">is_mo_in_call</span><span class="p">,</span>
                    <span class="n">ad_mt</span><span class="p">,</span>
                    <span class="n">get_slot_index_from_subid</span><span class="p">(</span><span class="n">ad_mt</span><span class="p">,</span> <span class="n">mt_sub_id</span><span class="p">),</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">is_mt_in_call</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tel_logger</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">result_value</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="s2">&quot;Failed to make MO call from </span><span class="si">%s</span><span class="s2"> slot </span><span class="si">%s</span><span class="s2"> to </span><span class="si">%s</span><span class="s2"> slot </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">ad_mo</span><span class="o">.</span><span class="n">serial</span><span class="p">,</span> <span class="n">mo_slot</span><span class="p">,</span> <span class="n">ad_mt</span><span class="o">.</span><span class="n">serial</span><span class="p">,</span> <span class="n">mt_slot</span><span class="p">)</span>
                    <span class="n">call_result_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">call_result_cycle_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cycle</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_take_bug_report</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">test_name</span><span class="p">,</span> <span class="n">begin_time</span><span class="o">=</span><span class="n">get_current_epoch_time</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">call_result_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">dialed_call_amount</span> <span class="o">=</span> <span class="n">dialed_call_amount</span> <span class="o">+</span> <span class="n">call_cycles</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">attempt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">CALCULATE_EVERY_N_CYCLES</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">attempt</span> <span class="o">==</span> <span class="n">test_cycles</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">exit_due_to_high_fail_rate</span><span class="p">:</span>

            <span class="n">parsing_fail</span> <span class="o">=</span> <span class="n">parse_cst_reg</span><span class="p">(</span>
                <span class="n">ad_mo</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">dds_slot</span><span class="p">,</span> <span class="n">cst_reg_search_intervals</span><span class="p">)</span>
            <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;====== Failed cycles of CST registration ======&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">each_dict</span> <span class="ow">in</span> <span class="n">parsing_fail</span><span class="p">:</span>
                <span class="n">print_nested_dict</span><span class="p">(</span><span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">each_dict</span><span class="p">)</span>

            <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;====== Failed cycles of CST voice call ======&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">call_result_list</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
                    <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s1">&#39;CST voice call cycle </span><span class="si">%s</span><span class="s1"> failed.&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">fail_rate</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">call_result_list</span><span class="p">)</span> <span class="o">-</span> <span class="n">call_result_list</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span>
                        <span class="n">call_result_list</span><span class="p">)</span>
                <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;====== Summary ======&#39;</span><span class="p">)</span>
                <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s1">&#39;Total CST calls: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">call_result_list</span><span class="p">))</span>
                <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s1">&#39;Total failed CST calls: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="n">call_result_list</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">False</span><span class="p">))</span>
                <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s1">&#39;Fail rate of CST voice call: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fail_rate</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s1">&#39;Fail rate of CST voice call: ERROR (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">enable_cst</span><span class="p">(</span><span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">exit_due_to_high_fail_rate</span><span class="p">:</span>
            <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s1">&#39;Test case is stopped due to fail rate is greater than 10%.&#39;</span><span class="p">)</span>
            <span class="k">break</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tests.google.tel.live.TelLiveRilCstVoiceTest.TelLiveRilCstVoiceTest.msim_cst_registration" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">msim_cst_registration</span><span class="p">(</span><span class="n">cst_slot</span><span class="p">,</span> <span class="n">rat</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">],</span> <span class="n">wfc_mode</span><span class="o">=</span><span class="n">WFC_MODE_WIFI_PREFERRED</span><span class="p">,</span> <span class="n">force_roaming</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">test_cycles</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Make MO/MT voice call at specific slot in specific RAT with DDS at
specific slot.</p>
<p>Test step:
1. Get sub IDs of specific slots of both MO and MT devices.
2. Switch DDS to specific slot.
3. Check HTTP connection after DDS switch.
4. Set up phones in desired RAT.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>cst_slot</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Slot at which CST registered</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>rat</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>RAT for both slots</p>
              </div>
            </td>
            <td>
                  <code>[&#39;&#39;, &#39;&#39;]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>wfc_mode</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>cullelar-preferred or wifi-preferred</p>
              </div>
            </td>
            <td>
                  <code><span title="acts_contrib.test_utils.tel.tel_defines.WFC_MODE_WIFI_PREFERRED">WFC_MODE_WIFI_PREFERRED</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>force_roaming</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True for fake roaming by setprop</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>test_cycles</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Amount of the test cycles</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True in the end. Otherwise the exception TestFailure will be raised.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>TestFailure if</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ol>
<li>Invalid sub ID is returned.</li>
<li>DDS cannot be switched successfully.</li>
<li>Http connection cannot be verified.</li>
</ol>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tests/google/tel/live/TelLiveRilCstVoiceTest.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">msim_cst_registration</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">cst_slot</span><span class="p">,</span>
        <span class="n">rat</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
        <span class="n">wfc_mode</span><span class="o">=</span><span class="n">WFC_MODE_WIFI_PREFERRED</span><span class="p">,</span>
        <span class="n">force_roaming</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">test_cycles</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make MO/MT voice call at specific slot in specific RAT with DDS at</span>
<span class="sd">    specific slot.</span>

<span class="sd">    Test step:</span>
<span class="sd">    1. Get sub IDs of specific slots of both MO and MT devices.</span>
<span class="sd">    2. Switch DDS to specific slot.</span>
<span class="sd">    3. Check HTTP connection after DDS switch.</span>
<span class="sd">    4. Set up phones in desired RAT.</span>

<span class="sd">    Args:</span>
<span class="sd">        cst_slot: Slot at which CST registered</span>
<span class="sd">        rat: RAT for both slots</span>
<span class="sd">        wfc_mode: cullelar-preferred or wifi-preferred</span>
<span class="sd">        force_roaming: True for fake roaming by setprop</span>
<span class="sd">        test_cycles: Amount of the test cycles</span>

<span class="sd">    Returns:</span>
<span class="sd">        True in the end. Otherwise the exception TestFailure will be raised.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TestFailure if:</span>
<span class="sd">            1. Invalid sub ID is returned.</span>
<span class="sd">            2. DDS cannot be switched successfully.</span>
<span class="sd">            3. Http connection cannot be verified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ads</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">android_devices</span>
    <span class="n">set_location_service</span><span class="p">(</span><span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">test_cycles</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">test_cycles</span><span class="p">)</span>
    <span class="n">cst_reg_search_intervals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cst_reg_fail</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">exit_due_to_high_fail_rate</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">test_cycles</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;======&gt; Test cycle </span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1"> &lt;======&#39;</span><span class="p">,</span> <span class="n">attempt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">test_cycles</span><span class="p">)</span>
        <span class="n">cst_reg_begin_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">cst_slot_sub_id</span> <span class="o">=</span> <span class="n">get_subid_from_slot_index</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cst_slot</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cst_slot_sub_id</span> <span class="o">==</span> <span class="n">INVALID_SUB_ID</span><span class="p">:</span>
            <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Failed to get sub ID ar slot </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">cst_slot</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">signals</span><span class="o">.</span><span class="n">TestFailure</span><span class="p">(</span>
                <span class="s1">&#39;Failed&#39;</span><span class="p">,</span>
                <span class="n">extras</span><span class="o">=</span><span class="p">{</span>
                    <span class="s1">&#39;fail_reason&#39;</span><span class="p">:</span> <span class="s1">&#39;Slot ID </span><span class="si">%s</span><span class="s1"> at slot </span><span class="si">%s</span><span class="s1"> is invalid.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">cst_slot_sub_id</span><span class="p">,</span> <span class="n">cst_slot</span><span class="p">)})</span>
        <span class="n">other_sub_id</span> <span class="o">=</span> <span class="n">get_subid_from_slot_index</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="o">-</span><span class="n">cst_slot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_cst</span><span class="p">(</span><span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">slot</span><span class="o">=</span><span class="n">cst_slot</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Step 1: Switch DDS.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">set_dds_on_slot</span><span class="p">(</span><span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">cst_slot</span><span class="p">):</span>
            <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to set DDS to slot </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">cst_slot</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">signals</span><span class="o">.</span><span class="n">TestFailure</span><span class="p">(</span>
                <span class="s1">&#39;Failed&#39;</span><span class="p">,</span>
                <span class="n">extras</span><span class="o">=</span><span class="p">{</span>
                    <span class="s1">&#39;fail_reason&#39;</span><span class="p">:</span> <span class="s1">&#39;Failed to set DDS to slot </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">cst_slot</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Step 2: Check HTTP connection after DDS switch.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">verify_http_connection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
            <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://www.google.com&quot;</span><span class="p">,</span>
            <span class="n">retry</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">retry_interval</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
            <span class="n">expected_state</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to verify http connection.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">signals</span><span class="o">.</span><span class="n">TestFailure</span><span class="p">(</span>
                <span class="s1">&#39;Failed&#39;</span><span class="p">,</span>
                <span class="n">extras</span><span class="o">=</span><span class="p">{</span>
                    <span class="s1">&#39;fail_reason&#39;</span><span class="p">:</span> <span class="s1">&#39;Failed to verify http connection.&#39;</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Verify http connection successfully.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Step 3: Set up phones in desired RAT.&quot;</span><span class="p">)</span>
        <span class="n">phone_setup_on_rat</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
            <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">rat</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="n">cst_slot</span><span class="p">],</span>
            <span class="n">other_sub_id</span><span class="p">)</span>

        <span class="n">phone_setup_on_rat</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
            <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">rat</span><span class="p">[</span><span class="n">cst_slot</span><span class="p">],</span>
            <span class="n">cst_slot_sub_id</span><span class="p">,</span>
            <span class="kc">False</span><span class="p">,</span>
            <span class="n">wfc_mode</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">toggle_wfc_for_subscription</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cst_slot_sub_id</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">set_wfc_mode_for_subscription</span><span class="p">(</span>
                <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">wfc_mode</span><span class="p">,</span> <span class="n">cst_slot_sub_id</span><span class="p">):</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="n">force_roaming</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">force_roaming</span><span class="p">(</span><span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cst_slot</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">wait_for_wfc_enabled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">cst_reg_fail</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">cst_reg_fail</span> <span class="o">&gt;=</span> <span class="n">test_cycles</span><span class="o">/</span><span class="mi">10</span><span class="p">:</span>
                <span class="n">exit_due_to_high_fail_rate</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">cst_reg_end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">ims_cst_reg_res</span> <span class="o">=</span> <span class="n">check_ims_cst_reg</span><span class="p">(</span>
            <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">cst_slot</span><span class="p">,</span>
            <span class="n">search_interval</span><span class="o">=</span><span class="p">[</span><span class="n">cst_reg_begin_time</span><span class="p">,</span> <span class="n">cst_reg_end_time</span><span class="p">])</span>

        <span class="k">while</span> <span class="ow">not</span> <span class="n">ims_cst_reg_res</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">cst_reg_end_time</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">WAIT_FOR_CST_REG_TIMEOUT</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ims_cst_reg_res</span> <span class="o">=</span> <span class="n">check_ims_cst_reg</span><span class="p">(</span>
                <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">cst_slot</span><span class="p">,</span>
                <span class="n">search_interval</span><span class="o">=</span><span class="p">[</span><span class="n">cst_reg_begin_time</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ims_cst_reg_res</span><span class="p">:</span>
            <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;IMS radio tech is NOT CrossStackEpdg.&#39;</span><span class="p">)</span>
            <span class="n">cst_reg_fail</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">cst_reg_fail</span> <span class="o">&gt;=</span> <span class="n">test_cycles</span><span class="o">/</span><span class="mi">10</span><span class="p">:</span>
                <span class="n">exit_due_to_high_fail_rate</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">attempt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">CALCULATE_EVERY_N_CYCLES</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">attempt</span> <span class="o">==</span> <span class="n">test_cycles</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">exit_due_to_high_fail_rate</span><span class="p">:</span>

            <span class="n">parsing_fail</span> <span class="o">=</span> <span class="n">parse_cst_reg</span><span class="p">(</span>
                <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cst_slot</span><span class="p">,</span> <span class="n">cst_reg_search_intervals</span><span class="p">)</span>
            <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;====== Failed cycles of CST registration ======&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">each_dict</span> <span class="ow">in</span> <span class="n">parsing_fail</span><span class="p">:</span>
                <span class="n">print_nested_dict</span><span class="p">(</span><span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">each_dict</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">enable_cst</span><span class="p">(</span><span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">exit_due_to_high_fail_rate</span><span class="p">:</span>
            <span class="n">ads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s1">&#39;Test case is stopped due to fail rate is greater than 10%.&#39;</span><span class="p">)</span>
            <span class="k">break</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.081f42fc.min.js"></script>
      
    
  </body>
</html>